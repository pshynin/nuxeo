<?xml version="1.0"?>
<component name="org.nuxeo.ecm.core.event.coldstorage.contribution">

  <!-- define the event that will be fired by the scheduler -->
  <extension target="org.nuxeo.ecm.core.scheduler.SchedulerService" point="schedule">
    <schedule id="checkAvailabilityOfBlobsBeingRetrieved">
      <!-- every hour -->
      <cronExpression>0 0 * ? * * *</cronExpression>
      <event>checkAvailabilityOfColdStorageContentBeingRetrieved</event>
    </schedule>
  </extension>

  <!-- define the listener that will handle the scheduler event -->
  <extension target="org.nuxeo.ecm.core.event.EventServiceComponent" point="listener">
    <listener name="checkAvailabilityOfBlobsBeingRetrieved" async="true"
              class="org.nuxeo.ecm.core.coldstorage.CheckAvailabilityOfColdStorageContentListener">
      <event>checkAvailabilityOfColdStorageContentBeingRetrieved</event>
    </listener>
  </extension>

  <!-- define the listener that will be responsible for sending the mails -->
  <extension
    target="org.nuxeo.ecm.platform.ec.notification.service.NotificationService"
    point="notifications">

    <notification name="ColdStorageContentBecomesAvailable" channel="email" enabled="true" availableIn="*"
                  subject="Archive content available on '${docTitle}'"
                  autoSubscribed="false" template="coldStorageContentBecomesAvailable"
                  label="label.document.download">
      <event name="coldStorageContentBecomesAvailable" />
    </notification>

  </extension>

  <extension
    target="org.nuxeo.ecm.platform.ec.notification.service.NotificationService"
    point="templates">
    <template name="coldStorageContentBecomesAvailable" src="templates/coldStorageContentAvailable.ftl" />
  </extension>

</component>
